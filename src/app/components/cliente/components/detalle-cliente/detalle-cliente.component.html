<!--version celu xd -->
<div class="block md:hidden">
  <div class="surface-card p-4 shadow-2 border-round">
    <h1 class="text-center mb-4">Registro de Pagos - {{ cliente?.nombre }}</h1>

    <p-dataView
      [value]="facturas"
      [rows]="5"
      [paginator]="true"
      layout="list"
    >
      <ng-template let-facturas pTemplate="list">
        <div class="grid grid-nogutter">
          <div *ngFor="let factura of facturas" class="col-12 mb-3">
            <div class="card flex flex-column surface-card p-3 border-1 surface-border">
              <div class="flex justify-content-between align-items-center mb-2">
                <div class="flex align-items-center">
                  <span class="font-bold mr-2">ID:</span>
                  <span>{{ factura.id }}</span>
                </div>
                <p-tag
                  [severity]="getStatusSeverity(factura.estado)"
                  [value]="factura.estado"
                ></p-tag>
              </div>

              <div class="mb-2">
                <div class="font-bold">Cliente</div>
                <div>{{ factura.cliente.nombre }}</div>
                <small class="text-color-secondary">{{ factura.cliente.rut }}</small>
              </div>

              <div class="grid mb-2">
                <div class="col-6">
                  <div class="font-bold">Fecha Emisión</div>
                  <div>{{ factura.fechaEmision | date:'dd/MM/yyyy' }}</div>
                </div>
                <div class="col-6">
                  <div class="font-bold">Mes</div>
                  <div>{{ factura.mesCorrespondiente | mesNombre }}</div>
                </div>
              </div>

              <div class="flex justify-content-between align-items-center mt-2">
                <div class="text-xl font-semibold">
                  {{ factura.montoTotal | currency:'CLP':'symbol':'1.0-0' }}
                </div>
                <p-button
                  icon="pi pi-eye"
                  styleClass="p-button-info p-button-sm"
                  (click)="verDetalles(factura)"
                ></p-button>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
    </p-dataView>
  </div>
</div>


<!-- version escritorio (original) -->
<div class="hidden md:block">
<div class="flex justify-content-center flex-wrap mt-8 mx-8">
  <div class="surface-card p-4 shadow-2 border-round w-full" style="min-height: 20rem">
    <div class="flex justify-content-center flex-wrap mt-4 mx-8">
      <h1>Registro de pagos y deudas de {{ cliente?.nombre }}</h1>
    </div>
    <div class="overflow-x-auto">


      <div class="grid">
        <div class="col-12">
          <p-table
            [value]="facturas"
            [paginator]="true"
            [rows]="5"
            responsiveLayout="stack"
            styleClass="p-datatable-gridlines"
            [breakpoint]="'960px'"
            [tableStyle]="{'min-width': '50rem'}"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Fecha Emisión</th>
                <th>Mes</th>
                <th>Monto Total</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-factura>
              <tr>
                <td>{{ factura.id }}</td>
                <td>
                  <div>{{ factura.cliente.nombre }}</div>
                  <small class="text-muted">{{ factura.cliente.rut }}</small>
                </td>
                <td>{{ factura.fechaEmision | date:'dd/MM/yyyy' }}</td>
                <td>
                  {{ factura.mesCorrespondiente | mesNombre }}
                </td>
                <td>
                  {{ factura.montoTotal | currency:'CLP':'symbol':'1.0-0' }}
                </td>
                <td>
                  <p-tag
                    [severity]="getStatusSeverity(factura.estado)"
                    [value]="factura.estado"
                  >
                  </p-tag>
                </td>
                <td>
                  <p-button
                    icon="pi pi-eye"
                    styleClass="p-button-info p-button-sm mr-2"
                    (click)="verDetalles(factura)"
                  >
                  </p-button>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
  </div>
</div>
</div>


<!-- este dialogo se podria mover a otro comnponente quizas-->
<p-dialog
  *ngIf="facturaSeleccionada"
  [(visible)]="mostrarDetalles"
  [header]="'Detalles Factura #' + facturaSeleccionada.id"
  [modal]="true"
  [style]="{width: '600px'}"
>
  <ng-template pTemplate="header">
    <div class="flex align-items-center justify-content-between w-full">
      <span>Detalles Factura #{{ facturaSeleccionada.id }}</span>
      <div>
        <p-button
          label="Agregar Pago"
          icon="pi pi-plus"
          styleClass="p-button-success mr-2"
          (click)="abrirModalAgregarPago()"
        ></p-button>
        <p-button
          label="Agregar Deuda"
          icon="pi pi-plus"
          styleClass="p-button-warning"
          (click)="abrirModalAgregarDeuda()"
        ></p-button>
      </div>
    </div>
  </ng-template>

  <div class="grid">
    <div class="col-12">
      <h3>Información Cliente</h3>
      <div class="p-grid">
        <div class="p-col-6">
          <strong>Nombre:</strong> {{ facturaSeleccionada.cliente.nombre }}
        </div>
        <div class="p-col-6">
          <strong>RUT:</strong> {{ facturaSeleccionada.cliente.rut }}
        </div>
        <div class="p-col-12">
          <strong>Email:</strong> {{ facturaSeleccionada.cliente.email }}
        </div>
      </div>
    </div>

    <div class="col-12">
      <h3>Detalles Factura</h3>
      <p-table
        [value]="facturaSeleccionada.detallesFactura"
        *ngIf="facturaSeleccionada.detallesFactura.length"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>Item</th>
            <th>Cantidad</th>
            <th>Subtotal</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-detalle>
          <tr>
            <td>{{ detalle.item.nombre }}</td>
            <td>{{ detalle.cantidad }}</td>
            <td>{{ detalle.subtotal | currency:'CLP':'symbol':'1.0-0' }}</td>
          </tr>
        </ng-template>
      </p-table>
      <p *ngIf="!facturaSeleccionada.detallesFactura.length">
        Sin detalles de factura
      </p>
    </div>

    <div class="col-12">
      <h3>Pagos</h3>
      <p-table
        [value]="facturaSeleccionada.pagos"
        *ngIf="facturaSeleccionada.pagos.length"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>Fecha</th>
            <th>Monto</th>
            <th>Método Pago</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-pago>
          <tr>
            <td>{{ pago.fechaPago | date:'dd/MM/yyyy' }}</td>
            <td>{{ pago.monto | currency:'CLP':'symbol':'1.0-0' }}</td>
            <td>{{ pago.metodoPago.nombre }}</td>
          </tr>
        </ng-template>
      </p-table>
      <p *ngIf="!facturaSeleccionada.pagos.length">Sin pagos registrados</p>
    </div>
  </div>
</p-dialog>
